# AI Prompt Helper v6.0.0 仕様書 (GAS API連携方式)

## 1. 概要

本ドキュメントは、AI Prompt Helper Chrome拡張機能 バージョン6.0.0の技術仕様、アーキテクチャ、UI設計を定義するものです。

### 1.1 プロジェクトの目的
Googleスプレッドシートでプロンプトデータを一元管理し、Google Apps Script (GAS) をAPIとして利用することで、GitHub Pages上のWebサイトからプロンプトのリアルタイムな読み書きを実現する。

---

## 2. アーキテクチャ

### 2.1. 全体構成図

```
+--------------------------+     +--------------------------+     +----------------------+
| GitHub Pages (編集サイト)  |<--->| Google Apps Script (API) |<--->| Googleスプレッドシート |
+--------------------------+     +--------------------------+     +----------------------+
        ^                                                            ^
        | (postMessage)                                              | (データ原本)
        v                                                            |
+--------------------------+                                           |
| Chrome拡張機能           |--------------------------------------------+
| (設定/UI提供)            |
+--------------------------+
```

### 2.2. データフロー
1.  **データ読み込み**: GitHub Pagesサイトは、GAS APIの`getPrompts`アクションをJSONP形式で呼び出し、スプレッドシートから全プロンプトデータを取得して表示する。
2.  **データ書き込み (追加/更新/削除)**: ユーザーがGitHub Pagesサイトで編集操作を行うと、サイトはGAS APIの対応するアクション (`addPrompt`, `updatePrompt`, `deletePrompt`) をJSONPで呼び出す。
3.  **API処理**: GASはリクエストを受け取り、入力値を検証した後、スプレッドシートの対応する行を操作する。
4.  **拡張機能連携**: ユーザーがGitHub Pagesサイトでプロンプトを選択すると、サイトは`postMessage` APIを使い、選択されたプロンプト本文を元のAIサイトのタブで待機している`content.js`に送信する。

### 2.3. 各コンポーネントの役割
- **データ原本**: Googleスプレッドシート。
- **バックエンドAPI**: `google-apps-script.js`。スプレッドシートを操作するCRUD APIを提供し、ウェブアプリとしてデプロイされる。
- **フロントエンド**: `docs/`ディレクトリ。プロンプトを管理するためのUIを提供し、GAS APIと通信するSPA。
- **Chrome拡張機能**: `src/`ディレクトリ。AIサイト上にUIを注入し、設定画面やGitHub Pagesサイトとの連携機能を提供する。

---

## 3. データ構造 (スプレッドシート)

| ヘッダー | 説明 |
|---|---|
| id | ユニークID (GAS側で自動生成) |
| title | プロンプトのタイトル |
| prompt | プロンプト本文 |
| memo | メモ |
| tags | タグ（カンマ区切り） |
| created_at | 作成日時 (GAS側で自動設定) |
| updated_at | 更新日時 (GAS側で自動設定) |
| deleted | 論理削除フラグ (GAS側で自動設定) |

- **補足**:
  - `id`, `created_at`, `updated_at`, `deleted` 列は、Google Apps Scriptによって自動的に管理されます。手動でデータを入力する際は、これらの列を空欄にしておくことを推奨します。
  - `tags` 列は、スプレッドシート上ではカンマ区切りの文字列として保存されます（例: `タグ1,タグ2`）。フロントエンド（GitHub Pages）では、この文字列が配列として処理されます。

---

## 4. API設計

詳細は`google-apps-script.js`内のコメントを参照。`doGet`関数が`action`パラメータに応じて処理を振り分ける。

- **action=getPrompts**: 全プロンプトを取得
- **action=addPrompt**: プロンプトを新規追加
- **action=updatePrompt**: 既存プロンプトを更新
- **action=deletePrompt**: プロンプトを論理削除

---

## 5. 実装とセットアップ

具体的なセットアップ手順は `project-docs/setup-instructions.md` を参照。