# AI Prompt Helper v6.0.0 仕様書

## 1. 概要

本ドキュメントは、AI Prompt Helper Chrome拡張機能 バージョン6.0.0の技術仕様、アーキテクチャ、UI設計を定義するものです。

### 1.1 プロジェクトの目的
Googleスプレッドシートでプロンプトデータを一元管理し、GitHub Actions経由で静的なJSONファイルとして配信することで、CORSの問題を回避しつつ、安全でメンテナンス性の高いプロンプト管理・利用システムを構築する。

### 1.2 対象読者
このプロジェクトの開発者、メンテナー。

---

## 2. v6.0.0 確定アーキテクチャ

CORSの問題とセキュリティ懸念を解決するため、以下のアーキテクチャを最終仕様とする。

### 2.1. 全体構成図

```
+----------------------+      +----------------------+      +-------------------------+
| Googleスプレッドシート |----->|   GitHub Actions     |----->|   docs/prompts.json     |
| (データ原本)         |      | (自動同期・変換処理)   |      | (静的JSONファイル)      |
+----------------------+      +----------------------+      +-------------------------+
                                                             |
                                                             | (GitHub Pagesで配信)
                                                             |
             +-----------------------------------------------+
             |
             v
+-----------------------------+      +--------------------------------+
|   Chrome拡張機能            |      |   GitHub Pagesサイト           |
| (prompts.jsonをフェッチ)    |      | (prompts.jsonを読み込む閲覧専用) |
+-----------------------------+      +--------------------------------+

```

### 2.2. データフロー
1.  **編集**: ユーザーは**Googleスプレッドシートを直接編集**してプロンプトを管理する。
2.  **同期**: GitHub Actionsが1時間ごと、または手動実行をトリガーとして起動する。
3.  **変換**: ワークフロー内で実行されるスクリプトが、スプレッドシートから全データを読み込み、`prompts.json`を生成する。
4.  **デプロイ**: 生成された`prompts.json`がリポジトリの`docs/`ディレクトリにコミットされ、GitHub Pagesに自動でデプロイされる。
5.  **参照**:
    *   Chrome拡張機能は `https://<username>.github.io/<repository>/prompts.json` をフェッチしてプロンプトを表示する。
    *   GitHub Pagesサイト (`docs/index.html`) は、同階層の`prompts.json`を読み込み、内容を**閲覧専用**で表示する。

### 2.3. 各コンポーネントの役割
- **データ原本**: Googleスプレッドシート。プロンプトの作成、編集、削除はここで行う。
- **自動同期**: GitHub Actionsが定期的にスプレッドシートのデータを取得し、`docs/prompts.json`としてリポジトリにコミットする。
- **データ配信**: `docs/prompts.json`はGitHub Pagesによって静的ファイルとしてWeb上に公開される。
- **データ利用**: Chrome拡張機能およびGitHub Pagesサイトは、公開された`prompts.json`を直接参照する。

---

## 3. データ構造 (`prompts.json`)

### 3.1. スキーマ
```json
{
  "version": "6.0.0",
  "lastUpdated": "2025-09-14T12:00:00Z",
  "prompts": [
    {
      "id": "prompt_001",
      "title": "プロンプトタイトル",
      "prompt": "実際のプロンプト本文...",
      "memo": "使用方法や注意点、改善履歴など",
      "tags": ["タグ1", "タグ2", "タグ3"],
      "created_at": "2025-09-14T10:00:00Z",
      "updated_at": "2025-09-14T11:00:00Z"
    }
  ]
}
```

### 3.2. 各項目の詳細
- **id**: スプレッドシートの行番号やユニークID。
- **title**: プロンプトの識別名・タイトル。
- **prompt**: AIに送信する実際のプロンプト本文。
- **memo**: 使用方法、コツ、改善履歴、注意点などの管理情報。
- **tags**: 検索・分類・フィルタリング用のタグ配列。
- **created_at / updated_at**: データの作成日時と最終更新日時。

---

## 4. UI設計 (GitHub Pages閲覧サイト)

### 4.1. デザイン方針
- **ベース**: ダークテーマ（目に優しく、モダンな印象）。
- **レイアウト**: カードベースのクリーンなデザイン。
- **役割**: 編集機能は持たず、プロンプトの**閲覧・検索・コピー**に特化する。

### 4.2. カラーパレット
```css
:root {
  --bg-primary: #1a1a1a;      /* メイン背景 */
  --bg-secondary: #2d2d2d;    /* サイドバー背景 */
  --bg-card: #363636;         /* カード背景 */
  --text-primary: #ffffff;    /* メインテキスト */
  --text-secondary: #cccccc;  /* サブテキスト */
  --accent: #8b5cf6;          /* アクセントカラー（紫） */
  --button: #4f46e5;          /* ボタンカラー（青紫） */
  --border: #4a4a4a;          /* ボーダー */
}
```

### 4.3. レイアウト設計
- **ヘッダー**: 検索バーと、「プロンプトの編集はGoogleスプレッドシートで行ってください」という案内、および対象シートへのリンクを設置。
- **サイドバー**: タグによるフィルタリング機能。
- **メインエリア**: プロンプトをカード形式で一覧表示。各カードにはプロンプトのタイトル、本文の一部、メモ、タグ、および「コピー」ボタンを配置する。

---

## 5. Chrome拡張機能 仕様

### 5.1. 動作フロー
1.  **[📝]ボタンクリック**: `content.js`が`popup.html`で設定されたGitHub PagesのURL（閲覧サイト）を新しいタブで開く。
2.  **プロンプト選択**: ユーザーが閲覧サイトでプロンプトの「コピー」ボタンをクリックすると、プロンプト本文がクリップボードにコピーされる。
3.  **自動貼り付け**: 閲覧サイトは`postMessage`で元のAIサイトタブに「プロンプト選択」を通知。`content.js`がメッセージを受け取り、クリップボードの内容をAIの入力欄に貼り付ける。
4.  **タブを閉じる**: 貼り付け後、閲覧サイトのタブは自動で閉じる。

### 5.2. `manifest.json`
```json
{
  "manifest_version": 3,
  "name": "AI Prompt Helper",
  "version": "6.0.0",
  "description": "GitHub Pagesとスプレッドシートで管理するプロンプトシステム",
  "permissions": [
    "activeTab",
    "storage",
    "clipboardRead"
  ],
  "content_scripts": [
    {
      "matches": [
        "*://chat.openai.com/*",
        "*://chatgpt.com/*",
        "*://claude.ai/*",
        "*://gemini.google.com/*",
        "*://bard.google.com/*",
        "*://copilot.microsoft.com/*",
        "*://perplexity.ai/*"
      ],
      "js": ["src/content.js"],
      "css": ["src/styles.css"]
    }
  ],
  "action": {
    "default_popup": "src/popup.html"
  },
  "icons": {
    "16": "icons/icon16.png",
    "48": "icons/icon48.png", 
    "128": "icons/icon128.png"
  }
}
```

### 5.3. `popup.html` 設定画面
- **設定項目**: 閲覧サイトのURL (`https://<username>.github.io/<repository>/`) を設定する入力欄。
- **機能**:
    - URLの保存機能。
    - 接続テストボタン (`prompts.json`へのアクセスを試みる)。
    - 閲覧サイトを開くボタン。

---

## 6. セキュリティ

- **機密情報管理**: GoogleスプレッドシートのIDや認証情報は、ソースコードには一切含めない。
- **GitHub Actions Secrets**: すべての機密情報をリポジトリの`Settings > Secrets and variables > Actions`に登録し、ワークフロー内でのみ安全に利用する。
- **オリジン検証**: `content.js`は`postMessage`を受信する際、メッセージの送信元が設定されたGitHub PagesのURLと一致するかを検証する。

---

## 7. 実装ステップ
1.  **GitHub Actions Secretsの設定**: スプレッドシートIDや認証情報などをSecretsに登録する。
2.  **データ変換スクリプトの作成**: スプレッドシートのデータを読み込み、JSONに変換するスクリプト（Node.js or GAS）をリポジトリに配置する。
3.  **GitHub Actionsワークフローの作成**: 定期実行と手動実行をトリガーに、上記スクリプトを実行し、変更があれば`docs/prompts.json`を自動コミットするワークフローを`.github/workflows/`以下に作成する。
4.  **Chrome拡張機能の改修**: `prompts.json`をURLから取得し、表示するロジックを実装する。
5.  **GitHub Pagesサイトの改修**: `prompts.json`を読み込んで表示する閲覧専用ページに修正する。
