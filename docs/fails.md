# fails.md - AI Prompt Helper v6.0.0 開発失敗事例

## 概要
v6.0.0開発中に発生した失敗・問題・解決策を記録する。将来の開発で同様の問題を避けるためのナレッジベース。

---

## 🚨 重要な失敗事例

### 1. manifest.json不在エラー
**発生日時**: 2025-09-13  
**症状**: Chrome拡張機能読み込み時に「マニフェストファイルが見つからない」エラー

**原因**:
- v6.0.0フォルダから必要ファイルをメインプロジェクトにコピーしていなかった
- manifest.json、icons、srcフォルダが不在

**解決策**:
```bash
cp versions/v6.0.0/manifest.json .
cp -r versions/v6.0.0/src .
cp -r versions/v6.0.0/icons .
```

**教訓**: プロジェクト構造変更時は必要ファイルの移動を確実に行う

---

### 2. GitHub Pagesフォルダ認識問題
**発生日時**: 2025-09-13  
**症状**: GitHub Pages設定でカスタムフォルダが選択肢に表示されない

**原因**:
- `github-pages-site/`フォルダがGitHubの標準フォルダ構造に対応していなかった
- GitHubは`/docs`フォルダのみをサポート

**解決策**:
```bash
mv github-pages-site docs
```

**教訓**: GitHub Pagesは`/` (root)または`/docs`フォルダのみサポート。カスタムフォルダ名は使用不可

---

### 3. 404エラーによる接続テスト失敗
**発生日時**: 2025-09-13  
**症状**: Chrome拡張機能の「接続テスト」で404エラー

**原因**:
- 接続テストが存在しない`data/prompts.json`ファイルを要求
- GitHub PagesサイトはHTMLベースなのにJSONファイルを期待

**解決策**: popup.jsの接続テスト機能を修正
```javascript
// 修正前: JSONファイルを要求
const dataUrl = url + '/data/prompts.json';

// 修正後: HTMLページ自体をテスト
const response = await fetch(url, {
    headers: { 'Accept': 'text/html' }
});
```

**教訓**: APIエンドポイントとWebページの違いを明確にする

---

### 4. デフォルトURL設定問題
**発生日時**: 2025-09-13  
**症状**: 拡張機能が架空のURL`username.github.io`に接続しようとする

**原因**:
- content.js、popup.htmlでプレースホルダーURLをそのまま使用
- 実際のGitHub Pages URLに更新していなかった

**解決策**:
```javascript
// content.js
return result.githubPagesUrl || 'https://ganta9.github.io/chrome_ext-ai_prompt_helper/';

// popup.html
placeholder="https://ganta9.github.io/chrome_ext-ai_prompt_helper/"
```

**教訓**: プレースホルダー値を実際の値に確実に置換する

---

### 5. GitHub Pages初期化エラー（継続中）
**発生日時**: 2025-09-13  
**症状**: GitHub Pagesサイトで「初期化に失敗しました」エラーが表示

**原因**: 調査中
- 可能性1: localStorage操作でのエラー
- 可能性2: サンプルデータ作成処理でのエラー
- 可能性3: DOM要素参照でのエラー

**対策済み**:
- 詳細エラーログの追加
- フォールバック処理の実装
- ステップ別のログ出力

**未解決**: 根本原因の特定と完全修正

**教訓**: 初期化処理は段階的にログを出力し、エラー箇所を特定しやすくする

---

## ⚠️ 中程度の問題

### 6. ファイル構造の二重管理
**発生日時**: 2025-09-13  
**症状**: versions/v6.0.0フォルダとメインプロジェクトで同じファイルが重複

**原因**:
- プロジェクト構造変更時の不適切なファイルコピー
- バージョン管理の方針が不明確

**解決策**:
- versions/v6.0.0フォルダを削除
- メインプロジェクトを正式版として統一

**教訓**: プロジェクト構造変更時はファイルの重複管理を避ける

---

### 7. オリジン検証の不備
**発生日時**: 2025-09-13  
**症状**: postMessage通信で「信頼できないオリジンからのメッセージ」警告

**原因**:
- オリジン検証リストに`githubusercontent.com`が未登録
- GitHub Pagesの実際のオリジンと不一致

**解決策**:
```javascript
const allowedDomains = [
    'github.io',
    'github.com',
    'githubusercontent.com', // 追加
    'localhost',
    '127.0.0.1'
];
```

**教訓**: セキュリティ検証は実際の運用環境に合わせて調整する

---

## 📝 軽微な問題

### 8. README.md更新漏れ
**発生日時**: 2025-09-13  
**症状**: README.mdがv4.0.0の内容のまま

**原因**: ドキュメント更新の作業漏れ

**解決策**: v6.0.0向けに完全書き換え

**教訓**: 機能実装と同時にドキュメントも更新する

---

### 9. TypeScript診断警告
**発生日時**: 2025-09-13  
**症状**: 
- 未使用変数 `e` 
- 非推奨API `document.execCommand`

**解決策**: 
- 未使用変数の削除
- 非推奨APIの代替実装検討（将来対応）

**教訓**: 定期的にコード品質チェックを行う

---

## 🔄 開発プロセスの改善点

### パターン分析

**頻出問題**:
1. ファイル不在・パス問題（3件）
2. URL・接続関連問題（2件）
3. 設定・構成問題（2件）

**予防策**:
1. **ファイル操作チェックリスト**の作成
2. **URL設定の検証手順**の標準化
3. **段階的デプロイ手順**の確立

### 推奨開発フロー
1. ローカル環境での完全テスト
2. ステージング環境（localhost）での検証
3. GitHub Pagesデプロイ
4. 本番環境での統合テスト

---

## 📊 統計情報

- **重要な失敗**: 5件（うち1件未解決）
- **中程度の問題**: 2件（解決済み）
- **軽微な問題**: 2件（解決済み）
- **解決率**: 88.9% (8/9)

---

## 🎯 今後の対策

### 即座に対応すべき項目
1. GitHub Pages初期化エラーの根本解決
2. エラーハンドリングの強化
3. 統合テストの実装

### 中長期的改善項目
1. 自動テストの導入
2. CI/CDパイプラインの構築
3. エラー監視システムの導入

---

**記録者**: Claude (claude.ai/code)  
**最終更新**: 2025-09-13  
**次回レビュー予定**: 次回メジャーアップデート時