# AI Prompt Helper v7.0.0 要求仕様書

**作成日**: 2025-09-15  
**対象バージョン**: v7.0.0  
**アーキテクチャ**: GitHubPages + Chrome拡張機能 統合システム

---

## 🎯 プロジェクト概要

### 背景・課題
- **v6.0.0の技術的制約**: GAS/Sheets依存によるCORS・CSP制約問題
- **Service Worker実装失敗**: DOM操作不可による根本的設計ミス
- **複雑なアーキテクチャ**: 多重システム依存による保守性の悪化

### 解決方針
- **GAS/Sheets完全排除**: GitHub Pages中心のシンプルアーキテクチャ
- **Chrome拡張機能強化**: GitHub PAT管理による安全な自動保存
- **平坦なデータ構造**: タグベース管理による柔軟性向上

---

## 📋 機能要求仕様

### 1. 基本機能要求

#### 1.1 プロンプトデータ管理
- **データ項目**:
  - タイトル（必須）
  - プロンプト本文（必須）
  - メモ（任意）
  - タグ（配列形式、任意）
  - 作成日時（自動生成）
  - 更新日時（自動更新）

#### 1.2 CRUD操作
- **Create**: 新規プロンプト作成
- **Read**: プロンプト一覧表示・詳細表示
- **Update**: 既存プロンプト編集
- **Delete**: プロンプト削除（論理削除）

#### 1.3 検索・フィルタリング（MVP範囲）
- **タイトル検索**: 部分一致検索
- **タグフィルタリング**: 複数タグでの絞り込み
- **ソート機能**: 作成日時・更新日時・タイトル順

### 2. 履歴管理要求

#### 2.1 履歴保存
- **対象**: プロンプト本文の変更のみ
- **保存期間**: 無制限（将来必要に応じて制限）
- **バージョン管理**: 連番による世代管理

#### 2.2 履歴表示・操作
- **履歴一覧**: 過去バージョンの時系列表示
- **差分表示**: 変更内容の可視化（将来実装）
- **復元機能**: 特定バージョンへの復元（将来実装）

### 3. 自動保存要求

#### 3.1 保存方式
- **Chrome拡張機能経由**: GitHub API使用
- **認証**: 既存GitHub PAT「GAS API for Prompt Sync — repo」活用
- **タイミング**: 編集完了時の自動保存

#### 3.2 セキュリティ要求
- **トークン管理**: Chrome Storage APIでの安全な保存
- **権限最小化**: repo権限のみ使用
- **エラーハンドリング**: 保存失敗時の適切な通知

---

## 🏗️ 技術仕様

### 1. データ構造仕様

#### 1.1 prompts.json構造
```json
{
  "version": "7.0.0",
  "last_updated": "2025-09-15T10:00:00Z",
  "prompts": [
    {
      "id": "p_a1b2c3d4",
      "title": "プロンプトタイトル",
      "prompt": "プロンプト本文",
      "memo": "メモ内容",
      "tags": ["tag1", "tag2", "tag3"],
      "created_at": "2025-01-10T10:00:00Z",
      "updated_at": "2025-01-15T15:30:00Z",
      "history": [
        {
          "version": 1,
          "prompt": "以前のプロンプト内容",
          "updated_at": "2025-01-10T10:00:00Z"
        }
      ]
    }
  ]
}
```

#### 1.2 ID生成仕様
- **形式**: 短縮UUID `p_xxxxxxxx`
- **プレフィックス**: `p_`
- **長さ**: 8文字のランダム文字列
- **文字セット**: 小文字英数字 `[a-z0-9]`

#### 1.3 タグ仕様
- **形式**: 配列 `["tag1", "tag2"]`
- **制約**: タグ名に「,」使用可能
- **ソート**: アルファベット順での表示

### 2. アーキテクチャ仕様

#### 2.1 システム構成
```
GitHubPages編集UI ↔ Chrome拡張機能 ↔ GitHub API ↔ prompts.json
```

#### 2.2 通信フロー
1. **編集操作**: GitHubPages UI → Chrome Extension メッセージ
2. **保存処理**: Chrome Extension → GitHub API → Repository
3. **反映確認**: GitHub API → Chrome Extension → UI更新

#### 2.3 Chrome拡張機能仕様
- **manifest.json**: host_permissions追加 `"*://api.github.com/*"`
- **storage**: GitHub PAT安全保存
- **background**: GitHub API通信処理
- **content_script**: 既存AI サイト対応維持

---

## 🚀 実装計画

### Phase 1: データ基盤構築
- [ ] prompts.json初期版作成
- [ ] 既存データ（v1.0.0）からの移行
- [ ] GitHub Pagesへの配置・確認

### Phase 2: Chrome拡張機能強化
- [ ] GitHub PAT設定UI追加
- [ ] Chrome Storage API実装
- [ ] GitHub API通信機能
- [ ] エラーハンドリング強化

### Phase 3: GitHubPages編集システム
- [ ] 基本UI設計・実装
- [ ] CRUD操作機能
- [ ] 検索・フィルタリング機能
- [ ] タグ管理UI

### Phase 4: 統合・自動化
- [ ] Chrome拡張機能↔GitHubPages通信
- [ ] 自動保存機能実装
- [ ] 包括的テスト
- [ ] ドキュメント整備

---

## 🎯 成功基準

### 1. 機能面
- ✅ GitHubPages上でプロンプトの完全なCRUD操作が可能
- ✅ タグによる効率的な分類・検索が可能
- ✅ Chrome拡張機能への自動反映が動作
- ✅ 編集内容の自動保存が安全に動作

### 2. 技術面
- ✅ GAS/Sheets依存の完全排除
- ✅ CORS・CSP制約問題の根本解決
- ✅ Service Worker不要のシンプル構成
- ✅ GitHub PAT安全管理による自動化

### 3. 保守性
- ✅ 単一データソース（prompts.json）による管理
- ✅ 明確なデータフロー・責任分担
- ✅ 段階的機能拡張が可能な設計
- ✅ 失敗事例に基づく予防策の実装

---

## 🚨 制約・リスク

### 1. 技術制約
- **GitHub API制限**: 1時間5000リクエスト
- **ファイルサイズ**: prompts.json大容量時のパフォーマンス
- **ブラウザ制約**: Chrome拡張機能必須

### 2. セキュリティリスク
- **GitHub PAT管理**: トークン漏洩リスク
- **権限範囲**: repo権限の広範なアクセス可能性
- **多人数利用**: 同時編集時の競合リスク

### 3. 運用制約
- **GitHub依存**: GitHub障害時の影響
- **トークン期限**: PAT期限切れ時の対応
- **バックアップ**: データ消失時の復旧手順

---

## 📊 品質保証

### 1. テスト要求
- **機能テスト**: 全CRUD操作の動作確認
- **統合テスト**: Chrome拡張機能↔GitHubPages連携
- **セキュリティテスト**: PAT管理・API通信の安全性
- **パフォーマンステスト**: 大量データ時の動作確認

### 2. レビュー要求
- **設計レビュー**: 各Phase完了時の設計確認
- **コードレビュー**: セキュリティ・品質観点での確認
- **ユーザビリティレビュー**: UI・UXの使いやすさ確認

### 3. ドキュメント要求
- **技術ドキュメント**: API仕様・データ構造
- **ユーザーガイド**: 設定手順・使用方法
- **運用ガイド**: トラブルシューティング・メンテナンス

---

## 📈 将来拡張

### 1. 機能拡張候補
- **履歴機能**: 差分表示・復元機能
- **共同編集**: 複数ユーザーでの同時編集
- **カテゴリ機能**: タグを基にした動的カテゴリ生成
- **エクスポート**: 他形式（CSV・Excel）への出力

### 2. 技術改善候補
- **GitHub Apps**: より安全な認証方式
- **WebAssembly**: 大量データ処理の高速化
- **PWA**: オフライン対応・ネイティブアプリ化
- **API**: 外部システムとの連携API提供

---

**承認者**: ユーザー  
**作成者**: Claude Code  
**次回レビュー**: Phase 1完了時