# プロンプト構成変更・更新ガイド（Ver5.0.0）

## 概要

このドキュメントは、Chrome拡張機能「AI Prompt Helper Ver5.0.0」のプロンプトフォルダ構成を変更・更新する際の手順とClaude Codeでの自動化指示について説明します。

## 現在のプロンプト構成（2025/8/24時点）

```
prompts/
├── 001_本気モード/
│   ├── 001_STEP0/
│   │   └── 001_コア設定.md
│   ├── 002_STEP1/
│   │   ├── 001_事前設定.md
│   │   └── 002_設定の完了.md
│   ├── 003_STEP1.5/
│   │   └── 001_会話継続支援.md
│   ├── 004_STEP2/
│   │   ├── 001_プロジェクト前提条件.md
│   │   ├── 002_要求仕様書添削.md
│   │   └── 003_リスクアセスメント.md
│   ├── 005_STEP3/
│   │   └── 001_不足情報の補完.md
│   └── 006_STEP5/
│       └── 001_回答生成手法のサンプル.md
└── 002_ワンショット/
    ├── 001_一般/
    │   ├── 001_文章校閲.md
    │   ├── 002_翻訳.md
    │   ├── 003_図解.md
    │   ├── 004_推論.md
    │   ├── 005_AI同士で議論.md
    │   └── 006_要求仕様書添削.md
    ├── 002_ペルソナ/
    │   └── 001_プロマネ.md
    └── 003_プログラム/
        ├── 001_一般.md
        ├── 002_一般2.md
        └── 003_コミットメッセージ.md
```

## 手動更新が必要なファイル

プロンプト構成を変更した場合、以下のファイルを手動で更新する必要があります：

### 1. src/content.js の scanPromptFolders() 関数

**場所**: 行73-123付近
**目的**: 実際のフォルダ構成と一致させる

**現在の関数構造**:
```javascript
async function scanPromptFolders() {
  console.log('Ver5.0.0自動生成版: 既存ファイルのみ読み込み');
  
  // 自動生成: [日時]
  return {
    categories: [
      {
        name: '001_本気モード',
        subcategories: [
          {
            name: '001_STEP0',
            prompts: ['001_コア設定.md']
          },
          // ... 他のサブカテゴリ
        ]
      },
      {
        name: '002_ワンショット',
        subcategories: [
          // ... サブカテゴリ一覧
        ]
      }
    ]
  };
}
```

**変更パターン**:
- カテゴリを追加する場合: `categories` 配列に新しいオブジェクトを追加
- サブカテゴリを追加する場合: 該当カテゴリの `subcategories` 配列に新しいオブジェクトを追加  
- プロンプトファイルを追加する場合: 該当サブカテゴリの `prompts` 配列に新しいファイル名を追加

### 2. VERSION_INFO.md（オプション）

**場所**: プロジェクトルート
**目的**: バージョン変更の記録

**更新内容**:
- 変更日時
- 追加/削除されたフォルダ・ファイル
- 変更理由

## Claude Code による自動更新手順

Claude Codeに以下の指示を与えることで、プロンプト構成の変更を自動化できます：

### 基本的な指示テンプレート

```
プロンプト構成が変更されました。以下の手順で更新してください：

1. `/Users/gantaku/Workspaces/chrome_ext-ai_prompt_helper/versions/v5.0.0/prompts/` フォルダの現在の構成を完全にスキャンしてください
2. `src/content.js` の `scanPromptFolders()` 関数を実際のフォルダ構成と一致するように更新してください
3. コメントの日時を現在の日時に更新してください
4. 変更内容を簡潔に報告してください
```

### 具体的な指示例

#### 新しいカテゴリを追加した場合
```
プロンプトフォルダに新しいカテゴリ「003_新カテゴリ名」を追加しました。
content.jsのscanPromptFolders()関数を更新して、この新しいカテゴリとその中のすべてのサブカテゴリ・プロンプトファイルを認識できるようにしてください。
```

#### サブカテゴリを追加した場合  
```
「001_本気モード」カテゴリに新しいサブカテゴリ「007_STEP6」を追加し、その中にプロンプトファイルを配置しました。
content.jsを更新してください。
```

#### プロンプトファイルを追加・変更した場合
```
既存のサブカテゴリにプロンプトファイルを追加/削除/名前変更しました。
プロンプトフォルダ全体をスキャンして、content.jsのscanPromptFolders()関数を現在の状況に合わせて更新してください。
```

### 推奨される詳細指示

最も確実な方法として、以下の詳細指示を推奨します：

```
以下のタスクを順番に実行してください：

1. Globツールまたはlsツールを使用して `/Users/gantaku/Workspaces/chrome_ext-ai_prompt_helper/versions/v5.0.0/prompts/` の完全なフォルダ・ファイル構造を取得

2. 取得した構造を基に、以下の形式でscanPromptFolders()関数の戻り値オブジェクトを再構成：
   - 各カテゴリフォルダ → categories配列の要素
   - 各サブカテゴリフォルダ → subcategories配列の要素  
   - 各.mdファイル → prompts配列の要素

3. src/content.js の73行目付近にある scanPromptFolders() 関数全体を新しい構成で置き換え

4. 関数内のコメント「// 自動生成: [日時]」を現在の日時で更新

5. 変更内容の概要を報告（追加・削除されたカテゴリ/サブカテゴリ/ファイル数）
```

## 注意事項

### ファイル命名規則
- **必須**: 数字接頭語（001_, 002_, 003_など）
- **必須**: .md拡張子
- **推奨**: 日本語でわかりやすい名前

### フォルダ構造ルール
- **固定**: 3階層（カテゴリ/サブカテゴリ/プロンプトファイル）
- **禁止**: 4階層以上のネスト
- **禁止**: 2階層以下の浅い構造

### 更新後の確認事項
1. **Chrome拡張機能の再インストール**が必要
2. **動作確認**: AIサイトでプロンプトメニューが正しく表示される
3. **エラーチェック**: ブラウザのコンソールでエラーが出ていない

## トラブルシューティング

### よくある問題

#### プロンプトが表示されない
- **原因**: scanPromptFolders()関数の構成が実際のフォルダと不一致
- **解決**: Claude Codeに再スキャンを依頼

#### 新しいファイルが認識されない
- **原因**: ファイル名に数字接頭語がない、または.md拡張子でない
- **解決**: 命名規則に従ってファイル名を修正

#### Chrome拡張機能でエラー
- **原因**: JavaScript構文エラーまたは存在しないファイルの参照
- **解決**: content.jsの構文チェック、ファイル存在確認

### 緊急時の復旧方法

1. **バックアップファイルの利用**
   ```bash
   cp src/content.js.backup src/content.js
   ```

2. **Claude Codeによる完全再構築**
   ```
   プロンプトフォルダの構成が壊れました。
   一から完全にスキャンして、正しいscanPromptFolders()関数を作り直してください。
   現在のプロンプトフォルダの構造を完全に分析してから実行してください。
   ```

## 更新履歴

- **2025/8/24**: 初版作成（Ver5.0.0対応）
- **現在の構成**: 2カテゴリ、9サブカテゴリ、18プロンプトファイル

---

このガイドを参照することで、プロンプト構成の変更を安全かつ確実に行うことができます。