<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Helper Editor</title>
    <link rel="icon" type="image/png" href="/icons/icon16.png">
    <link rel="stylesheet" href="style.css?v=2.0">
    <!-- マークダウンレンダリング用ライブラリ -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
</head>

<body>
    <!-- ヘッダー -->
    <header class="header">
        <div class="header-content">
            <h1 class="header-title">
                <span class="header-icon">📝</span>
                AI Prompt Helper Editor
            </h1>
            <div class="header-actions">
                <input type="text" id="search-input" class="search-input" placeholder="プロンプト検索...">
                <button id="add-prompt-btn" class="btn btn-primary">
                    <span>+</span> プロンプト追加
                </button>
                <button id="download-btn" class="btn btn-secondary">
                    <span>📥</span> JSONダウンロード
                </button>
                <button id="github-settings-btn" class="btn btn-secondary">
                    <span>⚙️</span> GitHub設定
                </button>
            </div>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="main">
        <!-- サイドバー -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>タグフィルター</h3>
                <button id="clear-filter-btn" class="btn-text">クリア</button>
            </div>
            <div class="tag-list" id="tag-list">
                <div class="tag-item active" data-tag="all">
                    <span class="tag-name">すべて</span>
                    <span class="tag-count" id="all-count">0</span>
                </div>
                <!-- タグ一覧は動的に生成 -->
            </div>
            <div class="sidebar-footer">
                <button id="add-tag-btn" class="btn btn-text">+ 新しいタグ</button>
            </div>
        </aside>

        <!-- プロンプト一覧 -->
        <section class="content">
            <div class="content-header">
                <h2 id="content-title">すべてのプロンプト</h2>
                <div class="content-meta">
                    <span id="prompt-count">0個のプロンプト</span>
                    <select id="sort-select" class="sort-select">
                        <option value="created">作成日順</option>
                        <option value="title">タイトル順</option>
                        <option value="updated">更新日順</option>
                    </select>
                </div>
            </div>

            <div class="prompt-grid" id="prompt-grid">
                <!-- プロンプトカードは動的に生成 -->
            </div>

            <!-- 空の状態 -->
            <div class="empty-state" id="empty-state" style="display: none;">
                <div class="empty-icon">📝</div>
                <h3>プロンプトがありません</h3>
                <p>最初のプロンプトを追加してみましょう</p>
                <button class="btn btn-primary" onclick="showAddModal()">プロンプト追加</button>
            </div>
        </section>
    </main>

    <!-- プロンプト追加・編集モーダル -->
    <div class="modal-overlay" id="prompt-modal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">プロンプト追加</h3>
                <button class="modal-close" id="modal-close">×</button>
            </div>

            <form class="modal-content" id="prompt-form">
                <div class="form-group">
                    <label for="prompt-title">タイトル <span class="required">*</span></label>
                    <input type="text" id="prompt-title" class="form-input" placeholder="例: 文章校閲プロンプト" required>
                </div>

                <div class="form-group">
                    <label for="prompt-content">プロンプト <span class="required">*</span></label>
                    <textarea id="prompt-content" class="form-textarea" rows="8"
                        placeholder="実際にAIに送信するプロンプト内容を入力してください..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="prompt-memo">メモ</label>
                    <textarea id="prompt-memo" class="form-textarea" rows="3"
                        placeholder="使用方法、コツ、改善履歴など..."></textarea>
                </div>

                <div class="form-group">
                    <label for="prompt-tags">タグ（カンマ区切りで入力）</label>
                    <input type="text" id="prompt-tags" class="form-input" placeholder="例: AI, 翻訳, コード, ビジネス">
                    <div class="tag-suggestions" id="tag-suggestions"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-btn">キャンセル</button>
                    <button type="submit" class="btn btn-primary" id="save-btn">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- プロンプト詳細・選択モーダル -->
    <div class="modal-overlay" id="detail-modal" style="display: none;">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 id="detail-title">プロンプト詳細</h3>
                <button class="modal-close" id="detail-close">×</button>
            </div>

            <div class="modal-content">
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>プロンプト</h4>
                        <div class="prompt-preview" id="detail-prompt"></div>
                    </div>

                    <div class="detail-section" id="detail-memo-section">
                        <h4>メモ</h4>
                        <div class="memo-content" id="detail-memo"></div>
                    </div>

                    <div class="detail-section">
                        <h4>タグ</h4>
                        <div class="tag-list-horizontal" id="detail-tags"></div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="detail-edit-btn">編集</button>
                    <button type="button" class="btn btn-danger" id="detail-delete-btn">削除</button>
                    <button type="button" class="btn btn-primary" id="detail-select-btn">このプロンプトを選択</button>
                </div>
            </div>
        </div>
    </div>

    <!-- プロンプトプレビューモーダル（プロンプト表示専用・大画面版） -->
    <div class="modal-overlay" id="preview-modal" style="display: none;">
        <div class="modal modal-preview">
            <div class="modal-header preview-header">
                <h3 id="preview-title">プロンプトプレビュー</h3>
                <button class="modal-close" id="preview-close">×</button>
            </div>

            <div class="modal-content preview-content">
                <!-- プロンプト表示メイン領域（90%+占有） -->
                <div class="preview-main">
                    <div class="prompt-preview markdown-content" id="preview-prompt"></div>
                </div>

                <!-- 最小限のメタ情報＋操作ボタン -->
                <div class="preview-footer">
                    <div class="preview-meta">
                        <span id="preview-date" class="preview-date"></span>
                    </div>
                    <div class="preview-actions">
                        <button type="button" class="btn btn-secondary btn-compact" id="preview-edit-btn">編集</button>
                        <button type="button" class="btn btn-danger btn-compact" id="preview-delete-btn">削除</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 削除確認モーダル -->
    <div class="modal-overlay" id="delete-modal" style="display: none;">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>プロンプト削除</h3>
                <button class="modal-close" id="delete-close">×</button>
            </div>

            <div class="modal-content">
                <p>このプロンプトを削除しますか？この操作は取り消せません。</p>
                <div class="delete-prompt-info">
                    <strong id="delete-prompt-title"></strong>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="delete-cancel">キャンセル</button>
                <button type="button" class="btn btn-danger" id="delete-confirm">削除</button>
            </div>
        </div>
    </div>

    <!-- GitHub設定モーダル -->
    <div class="modal-overlay" id="github-settings-modal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>GitHub API設定</h3>
                <button class="modal-close" id="github-settings-close">×</button>
            </div>

            <div class="modal-content">
                <div class="form-group">
                    <label for="github-token">GitHub Personal Access Token <span class="required">*</span></label>
                    <input type="password" id="github-token" class="form-input"
                           placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                    <small class="form-help">
                        GitHub Personal Access Token を入力してください。<br>
                        <strong>必要な権限:</strong> Contents: Write（リポジトリの内容を編集）
                    </small>
                </div>

                <div class="form-group">
                    <label>リポジトリ情報</label>
                    <div class="repo-info">
                        <div><strong>Owner:</strong> ganta9</div>
                        <div><strong>Repository:</strong> chrome_ext-ai_prompt_helper</div>
                        <div><strong>Branch:</strong> main</div>
                        <div><strong>File:</strong> prompts.json</div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="button" id="test-github-connection" class="btn btn-secondary">
                        接続テスト
                    </button>
                    <div id="github-status" class="status-message"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="github-cancel-btn">キャンセル</button>
                    <button type="button" class="btn btn-primary" id="github-save-btn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知 -->
    <div class="notification" id="notification" style="display: none;">
        <div class="notification-content">
            <span class="notification-icon" id="notification-icon">✓</span>
            <span class="notification-message" id="notification-message"></span>
        </div>
    </div>

    <!-- ローディング -->
    <div class="loading" id="loading" style="display: none;">
        <div class="loading-spinner"></div>
        <p>データを読み込み中...</p>
    </div>

    <!-- JavaScript -->
    <script src="script.js"></script>
</body>

</html>